{"uid":"3057e026d53c4b8d","name":"测试添加用户接口","fullName":"test_cases.api.system_manager.users.test_user_management.TestUserManagement#test_add_user","historyId":"7fe1d569f6fe623e59ef054f9340143d","time":{"start":1743952541371,"stop":1743952541412,"duration":41},"description":"\n        测试添加用户API接口\n        ","descriptionHtml":"<pre><code>    测试添加用户API接口\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: 添加用户失败，状态码: 500\nassert 500 in [200, 201]\n +  where 500 = <Response [500]>.status_code","statusTrace":"self = <test_cases.api.system_manager.users.test_user_management.TestUserManagement object at 0x106c1b5e0>\napi_client = <common.api_client.ApiClient object at 0x106c76790>\n\n    @allure.story(\"用户管理\")\n    @allure.title(\"测试添加用户接口\")\n    def test_add_user(self, api_client):\n        \"\"\"\n        测试添加用户API接口\n        \"\"\"\n        # 设置请求参数\n        endpoint = \"api/users\"\n        payload = {\n            \"username\": \"testuser\",\n            \"name\": \"测试用户\",\n            \"phone\": \"13800138000\",\n            \"email\": \"test@example.com\",\n            \"sex\": \"man\",\n            \"roles\": [0],  # 使用0作为角色ID\n            \"is_active\": True\n        }\n    \n        # 添加测试步骤\n        with allure.step(\"发送添加用户请求\"):\n            allure.attach(json.dumps(payload, ensure_ascii=False, indent=2),\n                         \"请求参数\", allure.attachment_type.JSON)\n            response = api_client.post(endpoint, json_data=payload)\n    \n        # 记录响应结果\n        with allure.step(\"获取响应结果\"):\n            allure.attach(response.text, \"响应内容\", allure.attachment_type.TEXT)\n            allure.attach(str(response.status_code), \"状态码\", allure.attachment_type.TEXT)\n    \n        # 断言响应状态码\n        with allure.step(\"验证响应状态码\"):\n>           assert response.status_code in [200, 201], f\"添加用户失败，状态码: {response.status_code}\"\nE           AssertionError: 添加用户失败，状态码: 500\nE           assert 500 in [200, 201]\nE            +  where 500 = <Response [500]>.status_code\n\ntest_cases/api/system_manager/users/test_user_management.py:47: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1743952541146,"stop":1743952541172,"duration":26},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1743952541172,"stop":1743952541172,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1743952541172,"stop":1743952541172,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"api_client","time":{"start":1743952541172,"stop":1743952541370,"duration":198},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1743952541172,"stop":1743952541172,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1743952541172,"stop":1743952541172,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n        测试添加用户API接口\n        ","status":"failed","statusMessage":"AssertionError: 添加用户失败，状态码: 500\nassert 500 in [200, 201]\n +  where 500 = <Response [500]>.status_code","statusTrace":"self = <test_cases.api.system_manager.users.test_user_management.TestUserManagement object at 0x106c1b5e0>\napi_client = <common.api_client.ApiClient object at 0x106c76790>\n\n    @allure.story(\"用户管理\")\n    @allure.title(\"测试添加用户接口\")\n    def test_add_user(self, api_client):\n        \"\"\"\n        测试添加用户API接口\n        \"\"\"\n        # 设置请求参数\n        endpoint = \"api/users\"\n        payload = {\n            \"username\": \"testuser\",\n            \"name\": \"测试用户\",\n            \"phone\": \"13800138000\",\n            \"email\": \"test@example.com\",\n            \"sex\": \"man\",\n            \"roles\": [0],  # 使用0作为角色ID\n            \"is_active\": True\n        }\n    \n        # 添加测试步骤\n        with allure.step(\"发送添加用户请求\"):\n            allure.attach(json.dumps(payload, ensure_ascii=False, indent=2),\n                         \"请求参数\", allure.attachment_type.JSON)\n            response = api_client.post(endpoint, json_data=payload)\n    \n        # 记录响应结果\n        with allure.step(\"获取响应结果\"):\n            allure.attach(response.text, \"响应内容\", allure.attachment_type.TEXT)\n            allure.attach(str(response.status_code), \"状态码\", allure.attachment_type.TEXT)\n    \n        # 断言响应状态码\n        with allure.step(\"验证响应状态码\"):\n>           assert response.status_code in [200, 201], f\"添加用户失败，状态码: {response.status_code}\"\nE           AssertionError: 添加用户失败，状态码: 500\nE           assert 500 in [200, 201]\nE            +  where 500 = <Response [500]>.status_code\n\ntest_cases/api/system_manager/users/test_user_management.py:47: AssertionError","steps":[{"name":"发送添加用户请求","time":{"start":1743952541371,"stop":1743952541409,"duration":38},"status":"passed","steps":[],"attachments":[{"uid":"ed01a325712b512","name":"请求参数","source":"ed01a325712b512.json","type":"application/json","size":172}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"获取响应结果","time":{"start":1743952541410,"stop":1743952541410,"duration":0},"status":"passed","steps":[],"attachments":[{"uid":"993a8671bd74d1df","name":"响应内容","source":"993a8671bd74d1df.txt","type":"text/plain","size":18843},{"uid":"de9c401cf36b52e6","name":"状态码","source":"de9c401cf36b52e6.txt","type":"text/plain","size":3}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},{"name":"验证响应状态码","time":{"start":1743952541410,"stop":1743952541410,"duration":0},"status":"failed","statusMessage":"AssertionError: 添加用户失败，状态码: 500\nassert 500 in [200, 201]\n +  where 500 = <Response [500]>.status_code\n","statusTrace":"  File \"/Users/Apple/PycharmProjects/himool_auto_case/test_cases/api/system_manager/users/test_user_management.py\", line 47, in test_add_user\n    assert response.status_code in [200, 201], f\"添加用户失败，状态码: {response.status_code}\"\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"a9cc27387ed48bd1","name":"log","source":"a9cc27387ed48bd1.txt","type":"text/plain","size":19204},{"uid":"96dbdd10278bf36","name":"stderr","source":"96dbdd10278bf36.txt","type":"text/plain","size":19212}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":3,"attachmentsCount":5,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"epic","value":"API测试"},{"name":"story","value":"用户管理"},{"name":"feature","value":"系统管理"},{"name":"parentSuite","value":"test_cases.api.system_manager.users"},{"name":"suite","value":"test_user_management"},{"name":"subSuite","value":"TestUserManagement"},{"name":"host","value":"MacBook-Pro.local"},{"name":"thread","value":"79289-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"test_cases.api.system_manager.users.test_user_management"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"3057e026d53c4b8d.json","parameterValues":[]}